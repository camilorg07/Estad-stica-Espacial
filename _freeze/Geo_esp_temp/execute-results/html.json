{
  "hash": "ba0f8fcb7e33e006fb49d6dd4ac6d432",
  "result": {
    "engine": "knitr",
    "markdown": "---\nbibliography: referencias.bib\nnocite: '@*'\n---\n\n\n\n\n\n::: {style=\"font-size: 1.5em; font-weight: bold; margin-bottom: 0.8em; margin-top: 0.5em;\"}\nAnálisis Geoestadístico Espacio Temporal de la Temperatura en el Estado de California durante marzo de 2024\n:::\n\n# Análisis Geoestadístico Espacio Temporal\n\n## Planteamiento del problema\n\n### Introducción\n\nLa calidad del aire es un elemento fundamental para la salud pública, el bienestar de las comunidades y el equilibrio de los ecosistemas. El deterioro de este recurso no solo incrementa el riesgo de enfermedades respiratorias y cardiovasculares, sino que también afecta la productividad, la calidad de vida y el funcionamiento de los sistemas naturales. En los últimos años, la preocupación por la contaminación atmosférica ha crecido debido a la combinación de factores antropogénicos y ambientales que intensifican la presencia de compuestos dañinos en la atmósfera, entre ellos el ozono troposférico y las variaciones extremas de temperatura.\n\nEn el estado de California, esta problemática adquiere una dimensión particular. Su elevada densidad poblacional, el tránsito vehicular, la actividad industrial y ciertos fenómenos naturales, como los incendios forestales, cada vez más frecuentes, contribuyen a que numerosas ciudades presenten niveles críticos de contaminación. Estas condiciones hacen necesario un análisis más profundo de la dinámica espacial y temporal de los contaminantes atmosféricos. En este contexto, el uso de herramientas estadísticas avanzadas, como el análisis espacio temporal, se convierte en un enfoque útil para comprender los patrones subyacentes y apoyar la toma de decisiones en materia ambiental.\n\n### Descripción de los datos\n\nLos datos objeto de este estudio provienen de la [Agencia de Protección Ambiental (EPA)](https://www.epa.gov/) de los Estados Unidos y corresponden a registros horarios obtenidos de las estaciones de monitoreo durante el mes de marzo de 2024. En particular, se analiza las variable **Temperatura ambiente (Temp)**.\n\n#### Unidades\n\n-   **Temperatura ambiente:** Medida en grados celsius (C°) con una intensidad horaria.\n\n### Objetivos\n\n#### Objetivo general\n\nModelar y predecir la distribución tridimensional (espacio y tiempo) de la Temperatura en el estado de California durante el periodo de 24 horas del 3 de marzo de 2024. Este análisis se realizará mediante el Kriging Espacio-Temporal, utilizando datos de 127 estaciones, con el fin de caracterizar la variabilidad espacio-temporal de la variable y generar un modelo de predicción.\n\n#### Objetivos específicos\n\n1.  Analizar la autocorrelación espacio-temporal de la Temperatura en California a lo largo de 24 horas mediante la construcción y análisis del semivariograma espacio-temporal empírico, y ajustar un modelo de semivariograma Teorico separable o no separable, que permita definir explícitamente la estructura de dependencia combinada entre las distancias espaciales y temporales.\n2.  Implementar Kriging Espacio Temporal para generar mapas de predicción espacial y mapas de incertidumbre, utilizando l estructura de covarianza estimada, con el fin de representar la distribución esperada de las variables y evaluar la precisión de las estimaciones.\n\n## Análisis Geoestadístico Espacio Temporal\n\nEn el análisis se consideran los datos de la **Temperatura** del periodo de 24 horas del 3 de marzo de 2024.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\n\n#Librerias necesarias ------\nlibrary(dplyr)\nlibrary(geoR)\nlibrary(sp)\nlibrary(readxl)\nlibrary(tidyr)\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(spacetime)\nlibrary(gstat)\nlibrary(GeoModels)\nlibrary(rcartocolor)\n\n#Variable Temperatura--------------------\n\nTemp <- read_excel(\"Temp_imp.xlsx\", sheet = \"Temperatura\")\nTemp <- as.data.frame(Temp)\nEstacionesT <- read_excel(\"Temp_imp.xlsx\", sheet = \"Estaciones\")\nEstacionesT$AQSID<-as.character(EstacionesT$AQSID)\nEstacionesT <- EstacionesT[,c(1,12,13)]\nTemp_long <- Temp %>% pivot_longer(cols = -DateTime, names_to = \"AQSID\",\n                                   values_to = \"value\") %>%  mutate(AQSID = as.character(AQSID))\nTemp_long<-Temp_long %>% \n  filter(as.Date(dmy_hms(Temp_long$DateTime)) == as.Date(\"2024-01-03\"))\nData_ST <- Temp_long %>% left_join(EstacionesT, by = \"AQSID\")\nData_ST$DateTime <- dmy_hms(Data_ST$DateTime)\nData_ST$Hora <- hour(Data_ST$DateTime)\n\n#Para el mapa de California -------------------------------\n\nsh_mundos<-st_read(\"admin00.shp\",quiet=TRUE)\nsh_mundos <- sh_mundos %>% filter(CNTRY_NAME==\"United States\")\nsh_mundos <- sh_mundos %>% filter(ADMIN_NAME==\"California\")\n\nCRS_UTM_NY = \"+init=epsg:3310\"\n\nsh_mundos_wgs84 <- st_transform(sh_mundos, crs = 4326)\n\nsh_mundos_utm <- st_transform(sh_mundos, crs = CRS(\"EPSG:3310\"))\n\nsh_mundos_sp_utm <- as(sh_mundos_utm, \"Spatial\")\n\nsh_mundos_utm_simple <- st_union(sh_mundos_utm)\nsh_mundos_sp_utm_simple <- as(sh_mundos_utm_simple, \"Spatial\")\n\n#Grilla para hacer kriging ------------------------------\n\nnew <- sp::spsample(as(sh_mundos_utm, \"Spatial\"), n = 5000, type = \"regular\")\n\nproj4string(new) <- CRS(\"EPSG:3310\")\ninvisible(coordinates(new) ~ Este + Norte)\ncolnames(new@coords) <- c(\"Este\", \"Norte\")\n```\n:::\n\n\n\n\n\n### Variable Temperatura\n\nEn el siguiente bloque se muestra el código utilizado para imputar los valores faltantes en las 127 estaciones de California a lo largo de las 744 observaciones temporales. A partir de los modelos ajustados en el [Análisis Univariado](#cap1), se estimó un semivariograma para cada instante en el tiempo, seleccionando el modelo adecuado según el criterio de MSE. Finalmente, la predicción espacial se llevó a cabo mediante la función `krige()` del paquete `gstat`.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nkrig_list <- list()\n\nProgress <- txtProgressBar(min = 0, max = nrow(Temp), style = 3)\n\nfor (i in 1:nrow(Temp)){\n  \n  y_T <- Temp[i,] #Tomar una fecha\n  y_T <- cbind(colnames(y_T),t(y_T[1,]))\n  y_T <- y_T[-1,]\n  y_T <- as.data.frame(y_T)\n  y_T <- na.omit(y_T)\n  y_T$V1 <- as.numeric(y_T$V1)\n  y_T <- inner_join(y_T, EstacionesT, by=c(\"V1\"=\"AQSID\"))\n  datosT <- y_T[,c(13,14,2)]\n  colnames(datosT)=c(\"Este\",\"Norte\",\"Temperatura\")\n  datosT$Temperatura <- as.numeric(datosT$Temperatura)\n  temp <- as.geodata(datosT)\n  vg <- quiet(\n        variog(temp, trend = ~Norte+Este+I(Este^2)+I(Este^3),\n               estimator.type = \"modulus\", pairs.min=50,\n               max.dist=7e5))\n  \n  est1 <- quiet(\n          variofit(vg, cov.model = \"exponential\", ini=ini1_exp_T,\n                   fix.nugget = F,\n                   wei = \"cressie\"))\n\n  est3 <- quiet(\n          variofit(vg, cov.model = \"spherical\", ini=ini1_es_T,\n                   fix.nugget = F,\n                   wei = \"cressie\"))\n  \n  par1 <- c(est1$nugget, est1$cov.pars[1], est1$cov.pars[2])\n  par3 <- c(est3$nugget, est3$cov.pars[1], est3$cov.pars[2])\n  \n  mse1 <- MSE_sv(vg$v, par1, NA, model = \"exponencial\", vg$u)\n  mse3 <- MSE_sv(vg$v, par3, NA, model = \"spherical\", vg$u)\n  \n  mse_values <- c(exponential = mse1, spherical = mse3)\n  best_model <- names(which.min(mse_values))\n  \n  best_fit <- switch(best_model,\n                     exponential = est1,\n                     gaussian = est2,\n                     spherical = est3)\n  \n  model_gstat <- switch(best_model,\n                        exponential = \"Exp\",\n                        gaussian = \"Gau\",\n                        spherical = \"Sph\")\n  \n  vgm_best <- gstat::vgm(psill = best_fit$cov.pars[1],\n                  model = model_gstat,\n                  range = best_fit$cov.pars[2],\n                  nugget = best_fit$nugget)\n\n  y_T_NA <- Temp[i, ]\n  y_T_NA <- cbind(colnames(y_T_NA), t(y_T_NA[1,]))\n  y_T_NA <- y_T_NA[-1,]\n  y_T_NA <- as.data.frame(y_T_NA)\n  y_T_NA <- y_T_NA[is.na(y_T_NA$V2), ]  # Filtrar las estaciones sin dato\n  y_T_NA$V1 <- as.numeric(y_T_NA$V1)\n  Estaciones <- y_T_NA$V1 \n  y_T_NA <- inner_join(y_T_NA, EstacionesT, by = c(\"V1\" = \"AQSID\"))\n  y_T_NA <- y_T_NA[,c(13,14,2)]\n  colnames(y_T_NA)=c(\"Este\",\"Norte\",\"Temperatura\")\n  \n  if (nrow(y_T_NA)==0) {\n    warning(paste(\"No valores faltantes a estimar\", i))\n    next\n  }\n                       \n  pred_grid <- y_T_NA[, c(\"Este\", \"Norte\")]\n  coordinates(datosT) <- ~Este+Norte\n  coordinates(pred_grid) <- ~Este + Norte\n  \n  krig_result <- quiet(gstat::krige(\n    formula = Temperatura ~ Norte + Este + I(Este^2) + I(Este^3),\n    locations = ~ Norte + Este,\n    data = as.data.frame(datosT),\n    newdata = pred_grid,\n    model = vgm_best,\n    nmin =20\n  ))\n  \n  Temp[i, as.character(Estaciones)] <- t(krig_result@data[[\"var1.pred\"]])\n  \n  setTxtProgressBar(Progress, i)\n}\n\nTemp[,-1] <- lapply(Temp[ , -1], function(x) round(as.numeric(x), 1))\n```\n:::\n\n\n\n\n\n#### Análisis de Estacionariedad en Media\n\nPara mitigar el efecto espacial en la media de la variable se uso el mismo modelo de regresión que se encontro en el [Análisis Univariado](#cap1):\n\n$$Temperatura = \\beta_0 + \\beta_1 \\times Norte + \\beta_2 \\times Norte^2$$\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nTemp.st.res <- as.data.frame(Data_ST) %>%\n  group_by(DateTime) %>% \n  mutate(value = resid(lm(value ~ Norte+I(Norte^2)))) %>%\n  ungroup()\n\ndataTemp.ST <- Data_ST%>% \n  arrange(AQSID, DateTime) %>%\n  dplyr::select(value)\n\n\ntime.index <- sort(unique(Data_ST$DateTime))\n\nTemp.stations.sp <- EstacionesT %>% arrange(AQSID)\n\nTemp.stations.sp <- SpatialPoints(Temp.stations.sp[,c(\"Este\", \"Norte\")])\n\n\ndatostime <- STFDF(Temp.stations.sp, time.index, dataTemp.ST)\nstplot(datostime, main = \"Temperatura en las 24 horas de 2024-01-03\")\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nIDs <- unique(EstacionesT$AQSID)\nsel <- NULL; for(i in 1:20) sel<-c(sel,which(IDs==IDs[i]))\n\nstplot(datostime[sel, \"2024-01-03\", \"value\"], mode=\"xt\", scaleX=0,\n       col.regions=terrain.colors(100), main = \"Temperatura\")\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n\n```{.r .cell-code}\nstplot(datostime[sel, \"2024-01-03\", \"value\"], mode=\"ts\",\n       main = \"Temperatura\")\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-3-3.png){width=672}\n:::\n:::\n\n\n\n\n\n#### Estudio del Semivariograma\n\n##### Estimación Empírica del Semivariograma\n\nMediante la función `GeoVariogram()` del paquete `GeoModels` se estimó el semivariograma empírico, su versión suavizada y los correspondientes semivariogramas marginales. Los resultados se presentan a continuación.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngeoMatrix <- Temp.st.res %>% \n  dplyr::select(DateTime, AQSID, value) %>%\n  tidyr::pivot_wider(names_from = AQSID, values_from = value) %>%\n  arrange(DateTime) %>%  \n  dplyr::select(-DateTime) %>%  \n  as.matrix()\n\ngeovgm <- GeoVariogram(data = geoMatrix, \n                       coordx = as.matrix(EstacionesT[,c(\"Este\", \"Norte\")]),\n                       coordt = unique(Data_ST$Hora - min(Data_ST$Hora)),\n                       distance = \"Eucl\", \n                       type= \"variogram\", \n                       maxdist = 8e+05)\n\nplot(geovgm)\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n\n##### Estimación del Modelo Teórico de Semivariograma\n\nMediante la función `GeoFit()` de la libreria `GeoModels()` se llevó a cabo la estimación del modelo teórico para el semivariograma espacio–temporal. Debido a las altas demandas computacionales asociadas al proceso de optimización, se decidió almacenar el resultado final en un archivo `.RData`. No obstante, en el siguiente bloque se presenta el código empleado para obtener dicha estimación.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n#Parámetros iniciales\n\ninit.ST_gne <- list(\n  scale_s = 1e5,\n  power_s = 1,\n  scale_t = 1,\n  power_t = 1,\n  sep     = 0.5,\n  sill    = 9,\n  nugget  = 0.1\n)\n\n#Mínimos de la grilla para la estimación\nlower.ST_gne <- list(\n  scale_s = 0.001,\n  power_s = 0.1,\n  scale_t = 0.001,\n  power_t = 0.1,\n  sep     = 0.01,\n  sill    = 0.001,\n  nugget  = 0\n)\n\n#Máximos de la grilla para la estimación\nupper.ST_gne <- list(\n  scale_s = 3e6,\n  power_s = 2,\n  scale_t = 12,\n  power_t = 2,\n  sep     = 0.99,\n  sill    = 20,\n  nugget  = 1\n)\n\ngeofit_gne <- GeoFit(data = geoMatrix, \n                     coordx = as.matrix(EstacionesT[,c(\"Este\", \"Norte\")]),\n                     coordt = unique(Data_ST$Hora - min(Data_ST$Hora)),\n                     distance = \"Eucl\", \n                     maxdist = 8e+05, \n                     maxtime =7, \n                     model = \"Gaussian\", \n                     corrmodel = \"Gneiting\", \n                     start = init.ST_gne, \n                     optimizer = \"L-BFGS-B\",\n                     fixed = fixed.ST_gne,\n                     lower = lower.ST_gne,\n                     upper = upper.ST_gne)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Carga del Optim\n\nload(\"geofitST3.RData\")\ngeocgvm<- GeoCovariogram(fitted = geofitST$Gneiting3, \n                         answer.vario = TRUE,\n                         show.vario = TRUE, \n                         add.vario = TRUE,\n                         vario = geovgm, \n                         invisible = TRUE)\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\n\n#### Kriging Espacio Temporal\n\nPara calcular las predicciones se hizo uso de la función `GeoKrig` de `GeoModels`. Debido a las altas demandas computacionales asociadas al proceso de optimización, se decidió almacenar el resultado final en un archivo `.xlsx`. No obstante, en el siguiente bloque se presenta el código empleado para obtener las predicciones:\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\npr <- GeoKrig(geofitST$Gneiting3, \n              loc = as.matrix(new@coords[,]), \n              time = c(24:29),\n              mse = TRUE)\n\npred <- pr$pred #Exportar los residuos predichos\n\n#Tomar todos los coeficientes de la regresión para cada tiempo\n\ncoefs <- as.data.frame(Data_ST) %>%\n  group_by(DateTime) %>%\n  do({\n    mod <- lm(value ~ Norte + I(Norte^2), data = .)\n    \n    # Residuales + fitted + datos originales\n    aug <- augment(mod)\n    \n    # Coeficientes\n    coef <- tidy(mod) %>%\n      mutate(DateTime = unique(.$DateTime))\n    \n    # Empaquetar: residuales + coeficientes replicados por fila\n    cbind(aug,\n          coef_intercept = coef$estimate[coef$term == \"(Intercept)\"],\n          coef_Norte     = coef$estimate[coef$term == \"Norte\"],\n          coef_Norte2    = coef$estimate[coef$term == \"I(Norte^2)\"])\n  }) %>%\n  ungroup()\n\ncoefs <- coefs %>% distinct(coef_intercept, coef_Norte, coef_Norte2)\n\n#Juntar todo en una misma matriz\n\nmelt_s <- data.frame(\n  t1 = pred[1,],\n  t2 = pred[2,],\n  t3 = pred[3,],\n  t4 = pred[4,],\n  t5 = pred[5,],\n  t6 = pred[6,],\n  X = new@coords[,1], \n  Y = new@coords[,2],\n  coef_intercept = mean(coefs$coef_intercept),\n  coef_Norte     = mean(coefs$coef_Norte),\n  coef_Norte2    = mean(coefs$coef_Norte2)\n)\n\n#Transformar a los valores reales\n\nmelt_s <- melt_s %>% mutate(\n                            t1 = t1 + coef_intercept+\n                              coef_Norte * Y + coef_Norte2*Y^2,\n                            t2 = t2 + coef_intercept+\n                              coef_Norte * Y + coef_Norte2*Y^2,\n                            t3 = t3 + coef_intercept+\n                              coef_Norte * Y + coef_Norte2*Y^2,\n                            t4 = t4 + coef_intercept+\n                              coef_Norte * Y + coef_Norte2*Y^2,\n                            t5 = t5 + coef_intercept+\n                              coef_Norte * Y + coef_Norte2*Y^2,\n                            t6 = t6 + coef_intercept+\n                              coef_Norte * Y + coef_Norte2*Y^2,\n)\n\n#Escribir el archivo\nwrite.csv(melt_s, \"pred_funcional.csv\")\n\n## Para el MSE\nMSE<-pr$mse\n\nMSE_s <- data.frame(\n  MSE1 = MSE[1,],\n  MSE2 = MSE[2,],\n  MSE3 = MSE[3,],\n  MSEt4 = MSE[4,],\n  MSE5 = MSE[5,],\n  MSE6 = MSE[6,],\n  X = new@coords[,1], \n  Y = new@coords[,2]\n)\n\nwrite.csv(MSE_s, \"mse_spac_time.csv\")\n```\n:::\n\n\n\n\n\nEn seguida se presentan predicciones para $t=6$ tiempos a futuro.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred <- read.csv(\"pred_funcional.csv\")\npred <- st_as_sf(pred,\n                   coords = c(\"X\", \"Y\"),\n                   crs = CRS_UTM_NY)\nerror <- read.csv(\"mse_spac_time.csv\")\nerror <- st_as_sf(error,\n                   coords = c(\"X\", \"Y\"),\n                   crs = CRS_UTM_NY)\n```\n:::\n\n\n\n\n\n::::::::: panel-tabset\n##### Primer Momento\n\n::: panel-tabset\n###### Predicción\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sh_mundos, fill = \"gray90\", color = \"gray30\", linewidth = 0.5) +\n  geom_sf(\n    data = pred, \n    aes(col = t1), \n    size = 3,          \n    alpha = 0.8 \n  ) +\n  scale_color_carto_c(palette = 'Prism', na.value = '#111111') +\n  labs(\n    title = \"Tiempo 1\",\n    color = \"Temperatura\"\n  ) +\n  theme_light()+\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\n\n###### Error de Predicción\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sh_mundos, fill = \"gray90\", color = \"gray30\", linewidth = 0.5) +\n  geom_sf(\n    data = error, \n    aes(col = MSE1), \n    size = 3,          \n    alpha = 0.8 \n  ) +\n  scale_fill_viridis_c(option = \"magma\",\n                       direction = -1) +\n  labs(\n    title = \"Tiempo 1\",\n    color = \"Error de predicción\"\n  ) +\n  theme_light()+\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n\n:::\n\n##### Segundo Momento\n\n::: panel-tabset\n###### Predicción\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sh_mundos, fill = \"gray90\", color = \"gray30\", linewidth = 0.5) +\n  geom_sf(\n    data = pred, \n    aes(col = t2), \n    size = 3,          \n    alpha = 0.8 \n  ) +\n  scale_color_carto_c(palette = 'Prism', na.value = '#111111') +\n  labs(\n    title = \"Tiempo 2\",\n    color = \"Temperatura\"\n  ) +\n  theme_light()+\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n\n\n###### Error de Predicción\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sh_mundos, fill = \"gray90\", color = \"gray30\", linewidth = 0.5) +\n  geom_sf(\n    data = error, \n    aes(col = MSE2), \n    size = 3,          \n    alpha = 0.8 \n  ) +\n  scale_fill_viridis_c(option = \"magma\",\n                       direction = -1) +\n  labs(\n    title = \"Tiempo 2\",\n    color = \"Error de predicción\"\n  ) +\n  theme_light()+\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n\n:::\n\n##### Tercer Momento\n\n::: panel-tabset\n###### Predicción\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sh_mundos, fill = \"gray90\", color = \"gray30\", linewidth = 0.5) +\n  geom_sf(\n    data = pred, \n    aes(col = t3), \n    size = 3,          \n    alpha = 0.8 \n  ) +\n  scale_color_carto_c(palette = 'Prism', na.value = '#111111') +\n  labs(\n    title = \"Tiempo 3\",\n    color = \"Temperatura\"\n  ) +\n  theme_light()+\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n\n\n###### Error de Predicción\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sh_mundos, fill = \"gray90\", color = \"gray30\", linewidth = 0.5) +\n  geom_sf(\n    data = error, \n    aes(col = MSE3), \n    size = 3,          \n    alpha = 0.8 \n  ) +\n  scale_fill_viridis_c(option = \"magma\",\n                       direction = -1) +\n  labs(\n    title = \"Tiempo 3\",\n    color = \"Error de predicción\"\n  ) +\n  theme_light()+\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n\n:::\n\n##### Cuarto Momento\n\n::: panel-tabset\n###### Predicción\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sh_mundos, fill = \"gray90\", color = \"gray30\", linewidth = 0.5) +\n  geom_sf(\n    data = pred, \n    aes(col = t4), \n    size = 3,          \n    alpha = 0.8 \n  ) +\n  scale_color_carto_c(palette = 'Prism', na.value = '#111111') +\n  labs(\n    title = \"Tiempo 4\",\n    color = \"Temperatura\"\n  ) +\n  theme_light()+\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\n\n\n###### Error de Predicción\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sh_mundos, fill = \"gray90\", color = \"gray30\", linewidth = 0.5) +\n  geom_sf(\n    data = error, \n    aes(col = MSEt4), \n    size = 3,          \n    alpha = 0.8 \n  ) +\n  scale_fill_viridis_c(option = \"magma\",\n                       direction = -1) +\n  labs(\n    title = \"Tiempo 4\",\n    color = \"Error de predicción\"\n  ) +\n  theme_light()+\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n\n:::\n\n##### Quinto Momento\n\n::: panel-tabset\n###### Predicción\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sh_mundos, fill = \"gray90\", color = \"gray30\", linewidth = 0.5) +\n  geom_sf(\n    data = pred, \n    aes(col = t5), \n    size = 3,          \n    alpha = 0.8 \n  ) +\n  scale_color_carto_c(palette = 'Prism', na.value = '#111111') +\n  labs(\n    title = \"Tiempo 5\",\n    color = \"Temperatura\"\n  ) +\n  theme_light()+\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n\n\n###### Error de Predicción\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sh_mundos, fill = \"gray90\", color = \"gray30\", linewidth = 0.5) +\n  geom_sf(\n    data = error, \n    aes(col = MSE5), \n    size = 3,          \n    alpha = 0.8 \n  ) +\n  scale_fill_viridis_c(option = \"magma\",\n                       direction = -1) +\n  labs(\n    title = \"Tiempo 5\",\n    color = \"Error de predicción\"\n  ) +\n  theme_light()+\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n\n:::\n\n##### Sexto Momento\n\n::: panel-tabset\n###### Predicción\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sh_mundos, fill = \"gray90\", color = \"gray30\", linewidth = 0.5) +\n  geom_sf(\n    data = pred, \n    aes(col = t6), \n    size = 3,          \n    alpha = 0.8 \n  ) +\n  scale_color_carto_c(palette = 'Prism', na.value = '#111111') +\n  labs(\n    title = \"Tiempo 6\",\n    color = \"Temperatura\"\n  ) +\n  theme_light()+\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n\n\n\n###### Error de Predicción\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sh_mundos, fill = \"gray90\", color = \"gray30\", linewidth = 0.5) +\n  geom_sf(\n    data = error, \n    aes(col = MSE6), \n    size = 3,          \n    alpha = 0.8 \n  ) +\n  scale_fill_viridis_c(option = \"magma\",\n                       direction = -1) +\n  labs(\n    title = \"Tiempo 6\",\n    color = \"Error de predicción\"\n  ) +\n  theme_light()+\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](Geo_esp_temp_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n\n:::\n:::::::::\n\n## Conclusiones\n\n::: {.callout-caution appearance=\"simple\"}\n## En desarrollo...\n:::\n\n# Referencias {.unnumbered}\n",
    "supporting": [
      "Geo_esp_temp_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}